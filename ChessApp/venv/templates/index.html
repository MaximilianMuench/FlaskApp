{% extends "page_template.html" %}
{% block main_body %}
{% macro show_games(a) %}
<ul class="list-group">
    {% for game in range(numberOfGames) %}
        {% if games[game] == 0 %}
            <li id="{{ game }}" class="list-group-item clearfix" style="color: green;">Game Number: {{ game }}, Number of Players: {{ games[game] }}
                <a href="/game/{{ game }}">
                    <input gameval='{{ game }}' type="button" class="btn btn-success pull-right" value="Join Game"></input>
                </a>
            </li>
        {% endif %}
        {% if games[game] == 1 %}
            <li id="{{ game }}" class="list-group-item clearfix" style="color: blue;">Game Number: {{ game }}, Number of Players: {{ games[game] }}
                <a href="/game/{{ game }}">
                    <input gameval='{{ game }}' type="button" class="btn btn-success pull-right" value="Join Game"></input>
                </a>
            </li>
        {% endif %}
        {% if games[game] == 2 %}
            <li id="{{ game }}" class="list-group-item clearfix" style="color: red;">Game Number: {{ game }}, Number of Players: {{ games[game] }}
                <a href="/spectate/{{ game }}">
                    <input gameval='{{ game }}' type="button" class="btn btn-default pull-right" value="Spectate"></input>
                </a>
            </li>
        {% endif %}
    {% endfor %}
</ul>
{% endmacro %}
<script>
    setInterval(function() {
        $.ajax({
            type: "POST",
            url: '/get_games',
            success: function(data) {
                data = JSON.parse(data);
                for (var i=0; i<data.length; i++){
                    try {
                        el = document.getElementById(i);
                        el.innerHTML = "Game Number: " + i + ", Number of Players: " + data[i];
                        if (data[i] == 0) {
                            el.style.color = "green";
                            el.innerHTML += "<input gameval='" + i + "'type='button' class='btn btn-success pull-right' value='Join Game'></input>";
                        } else if(data[i] == 1) {
                            el.style.color = "blue";
                            el.innerHTML += "<input gameval='" + i + "'type='button' class='btn btn-success pull-right' value='Join Game'></input>";
                        } else {
                            el.style.color = "red";
                            el.innerHTML += "<input gameval='" + i + "'type='button' class='btn btn-default pull-right' value='Spectate'></input>";
                        }
                    } catch(e) {
                        console.error("Game not being displayed");
                    }
                }
            }
        });
    }, 5000);
    document.addEventListener("click", function(event){
        if (event.target.type == "button"){
            if (event.target.value == "Join Game"){
                var game_num = event.target.getAttribute('gameval');
            } else if (event.target.value == "Spectate"){
                var game_num = event.target.getAttribute('gameval');
            } else if (event.target.value == "Join New Game") {

                $.ajax({
                    type: "POST",
                    url: "/",
                    success: function(data) {
                        data = JSON.parse(data);
                        if (data == "error") {

                        } else {
                            window.location.href = data;
                        }
                    }
                });
            } else if (event.target.value == "Create New Game") {
                $.ajax({
                    type: "POST",
                    url: "/create_game",
                    success: function() {

                    }
                });
            }
        }
    });
</script>
<!-- Main game loading -->
<div class='container' id="main-div">
    <div id="stuff">
        {{ show_games() }}
    </div>

    <!-- Implementing Create Game Button -->
    <div>
        <input type="button" class="btn btn-primary" value="Join New Game"></input>
        <input type="button" class="btn btn-primary" value="Create New Game"></input>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<div class='container'>

</div>
{% endblock %}